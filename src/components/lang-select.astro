---
import { getLanguageFromURL } from '@/utils';

export interface Props {
  classes?: string;
}

const { classes } = Astro.props;
const { pathname } = Astro.url;
const lang = getLanguageFromURL(pathname);
---

<select class={`lang-select bg-transparent ${classes ? classes : ''}`}>
  <option value="en" selected={lang === 'en'}>ðŸ‡ºðŸ‡¸ English</option>
  <option value="es" selected={lang === 'es'}>ðŸ‡¨ðŸ‡´ EspaÃ±ol</option>
</select>

<script>
  import { stripLangFromSlug } from '@/helpers/route';

  const selects = document.querySelectorAll('.lang-select');

  selects.forEach((select) => {
    select?.addEventListener('change', function (e) {
      console.log('entra');
      const selectedLang = e.target?.value || 'en';

      const { pathname } = window.location;
      const path = stripLangFromSlug(pathname);
      const isEmpty = path.length == 0;
      const newPath = isEmpty ? `/${selectedLang}` : `/${selectedLang}/${path}`;

      window.location.replace(newPath);
    });
  });
</script>
