---
import { getCollection } from 'astro:content';
import {
  getLangFromSlug,
  getLanguageFromURL,
  readingTime,
  stripLangFromSlug,
} from '@/utils';
import Layout from '@/layouts/general.astro';
import Card from '@/components/card-blog.astro';

const blogs = await getCollection('blog', (item) => !item.data.draft);
const { pathname } = Astro.url;
const lang = getLanguageFromURL(pathname);

const meta = {
  title: 'Blog - Juan Sebastián Reina 👨‍💻',
  description: 'Acá comparto y documento esos momentos de extenso aprendizaje',
  keywords: 'Web development, Coding, Life Style, Business',
};

export async function getStaticPaths() {
  return [{ params: { lang: 'es' } }];
}
---

<Layout meta={meta}>
  <h1 class="mb-4 leading-tight">Blog</h1>
  <ul>
    {
      blogs.map(({ data, slug, body }) => {
        const newSlug = stripLangFromSlug(slug);
        const link = `/${lang}/blog/${newSlug}`;
        return (
          <Card
            title={data.title}
            alt={data.image.alt}
            src={data.image.src}
            sources={[
              { media: '(max-width: 400px)', trw: 600 },
              { media: '(min-width: 401px)', trw: 800 },
            ]}
            href={link}
            publishedAt={data.publishedAt}
            readingTime={readingTime(body)}
            classes="mb-8"
          />
        );
      })
    }
  </ul>
</Layout>
